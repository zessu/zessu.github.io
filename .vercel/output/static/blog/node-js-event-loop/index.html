<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><script type="module" src="/_astro/BlogPost.astro_astro_type_script_index_0_lang.VZXdc8kb.js"></script><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="preload" href="/_astro/twinkle-star-latin-400-normal.CutCPZrC.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/_astro/geist-latin-wght-normal.Dm3htQBi.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/_astro/roboto-mono-latin-wght-normal.CZtBPCCa.woff2" as="font" type="font/woff2" crossorigin><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.16.5"><!-- Canonical URL --><link rel="canonical" href="https://drew.is-a.dev/blog/node-js-event-loop/"><!-- Primary Meta Tags --><title>How the NodeJS event loop works</title><meta name="title" content="How the NodeJS event loop works"><meta name="description" content="How the NodeJS event loop works"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://zessu.github.io/"><meta property="og:title" content="How the NodeJS event loop works"><meta property="og:description" content="How the NodeJS event loop works"><meta property="og:image" content="https://drew.is-a.dev/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://x.com/amackzie"><meta property="twitter:title" content="How the NodeJS event loop works"><meta property="twitter:description" content="How the NodeJS event loop works"><meta property="twitter:image" content="https://drew.is-a.dev/blog-placeholder-1.jpg"><script>
    if (localStorage.getItem('darkmode')) {
        document.documentElement.classList.add('darkmode');
    }
</script><link rel="stylesheet" href="/_astro/_slug_.VBcr8UrD.css">
<style>.Btn[data-astro-cid-bvzihdzo]{height:25px;display:flex;align-items:center;justify-content:space-between;border:none;border-radius:5px;overflow:hidden;box-shadow:5px 5px 10px #00000017;cursor:pointer;background-color:transparent;padding:0}.leftContainer[data-astro-cid-bvzihdzo]{height:100%;background-color:#e00;display:flex;align-items:center;justify-content:center;padding:10px;gap:8px}.leftContainer[data-astro-cid-bvzihdzo] .like[data-astro-cid-bvzihdzo]{color:#fff;font-weight:600}.count[data-astro-cid-bvzihdzo]{height:100%;display:flex;align-items:center;justify-content:center;font-weight:600;position:relative;background-color:#fff;padding:5px;color:#e00}.Btn[data-astro-cid-bvzihdzo]:hover .leftContainer[data-astro-cid-bvzihdzo]{background-color:#db0000}.Btn[data-astro-cid-bvzihdzo]:active .leftContainer[data-astro-cid-bvzihdzo]{background-color:#c90000}.Btn[data-astro-cid-bvzihdzo]:active .leftContainer[data-astro-cid-bvzihdzo] svg[data-astro-cid-bvzihdzo]{transform:scale(1.15);transform-origin:top}div[data-astro-cid-bvzihdzo]#like-container{display:flex;align-items:center;justify-content:center}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{color:var(--fontColor)}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;text-align:center}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:var(--gray)}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}#sf-reading-progress-bar[data-astro-cid-bvzihdzo]{position:fixed;top:0;left:0;z-index:9999;width:0%;height:5px;background-color:#46a787;margin:0}
</style><script type="module" src="/_astro/page.Cungvx1b.js"></script></head> <body class="" data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <div data-astro-cid-3ef6ksr2> <span id="name" data-astro-cid-3ef6ksr2>Andrew Makenzi</span> </div> <div class="internal-links" data-astro-cid-3ef6ksr2> <div data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" class="mb-0 p-0"> <svg viewBox="0 0 24 24" fill="none" height="35px" width="35px" xmlns="httpwww.w3.org/2000/svg" data-astro-cid-3ef6ksr2><g id="SVGRepo_bgCarrier" stroke-width="0" data-astro-cid-3ef6ksr2></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-3ef6ksr2></g><g id="SVGRepo_iconCarrier" data-astro-cid-3ef6ksr2> <path d="M22 22L2 22" stroke="var(--logoColor)" stroke-width="1.5" stroke-linecap="round" data-astro-cid-3ef6ksr2></path> <path d="M2 11L6.06296 7.74968M22 11L13.8741 4.49931C12.7784 3.62279 11.2216 3.62279 10.1259 4.49931L9.34398 5.12486" stroke="var(--logoColor)" stroke-width="1.5" stroke-linecap="round" data-astro-cid-3ef6ksr2></path> <path d="M15.5 5.5V3.5C15.5 3.22386 15.7239 3 16 3H18.5C18.7761 3 19 3.22386 19 3.5V8.5" stroke="var(--logoColor)" stroke-width="1.5" stroke-linecap="round" data-astro-cid-3ef6ksr2></path> <path d="M4 22V9.5" stroke="var(--logoColor)" stroke-width="1.5" stroke-linecap="round" data-astro-cid-3ef6ksr2></path> <path d="M20 9.5V13.5M20 22V17.5" stroke="var(--logoColor)" stroke-width="1.5" stroke-linecap="round" data-astro-cid-3ef6ksr2></path> <path d="M15 22V17C15 15.5858 15 14.8787 14.5607 14.4393C14.1213 14 13.4142 14 12 14C10.5858 14 9.87868 14 9.43934 14.4393M9 22V17" stroke="var(--logoColor)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-3ef6ksr2></path> <path d="M14 9.5C14 10.6046 13.1046 11.5 12 11.5C10.8954 11.5 10 10.6046 10 9.5C10 8.39543 10.8954 7.5 12 7.5C13.1046 7.5 14 8.39543 14 9.5Z" stroke="var(--logoColor)" stroke-width="1.5" data-astro-cid-3ef6ksr2></path> </g></svg> </a> <a href="/blog" data-astro-cid-3ef6ksr2="true" class="mb-0 p-0">  </a> </div> </div> <button class="text-(--logoColor) rounded-full flex justify-center items-center cursor-pointer p-2" id="theme-switch" data-astro-cid-3ef6ksr2> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon-icon lucide-moon" data-astro-cid-3ef6ksr2><path d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401" data-astro-cid-3ef6ksr2></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun-icon lucide-sun" data-astro-cid-3ef6ksr2><circle cx="12" cy="12" r="4" data-astro-cid-3ef6ksr2></circle><path d="M12 2v2" data-astro-cid-3ef6ksr2></path><path d="M12 20v2" data-astro-cid-3ef6ksr2></path><path d="m4.93 4.93 1.41 1.41" data-astro-cid-3ef6ksr2></path><path d="m17.66 17.66 1.41 1.41" data-astro-cid-3ef6ksr2></path><path d="M2 12h2" data-astro-cid-3ef6ksr2></path><path d="M20 12h2" data-astro-cid-3ef6ksr2></path><path d="m6.34 17.66-1.41 1.41" data-astro-cid-3ef6ksr2></path><path d="m19.07 4.93-1.41 1.41" data-astro-cid-3ef6ksr2></path></svg> </button> </nav> </header>  <script type="module">const e=document.getElementById("theme-switch");e?.addEventListener("click",()=>{document.documentElement.classList.toggle("darkmode"),document.documentElement.classList.contains("darkmode")?localStorage.setItem("darkmode","true"):localStorage.removeItem("darkmode")});</script> <main class="flex flex-col items-center justify-center p-4" data-astro-cid-bvzihdzo> <div class="w-full sm:w-[90%]" data-astro-cid-bvzihdzo> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2023-10-03T21:00:00.000Z" class="font-(family-name:--my-date-font) font-semibold tracking-tight"> Oct-04-2023 </time>  </div> <h2 data-astro-cid-bvzihdzo>How the NodeJS event loop works</h2> <div id="like-container" data-astro-cid-bvzihdzo> <button class="Btn" data-astro-cid-bvzihdzo> <span class="leftContainer" id="increaseCount" data-astro-cid-bvzihdzo> <svg fill="white" viewBox="0 0 512 512" height="1em" xmlns="http://www.w3.org/2000/svg" data-astro-cid-bvzihdzo><path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z" data-astro-cid-bvzihdzo></path></svg> <span class="like" data-astro-cid-bvzihdzo>Like</span> </span> <span class="count" id="like-count" data-astro-cid-bvzihdzo> 0 likes </span> <span class="count" id="read-count" data-astro-cid-bvzihdzo> 0 reads </span> </button> </div> </div> <hr data-astro-cid-bvzihdzo> <div id="sf-reading-progress-bar" data-astro-cid-bvzihdzo></div>  <p>The event loop is the mechanism by which <strong>NodeJs</strong> executes asynchronous tasks. By nature Javascript is single threaded, so any resource intensive tasks like doing math operations or reading from a file would block the main thread. NodeJS works with JS so to get around this limitation, it introduced the Event loop. This is how it works</p>
<p>NodeJS relies on a call stack and some callback queues. The call stack is a space in memory where execution steps in a program are stored and executed. If you had a synchronous program like so</p>
<pre class="astro-code astro-code-themes synthwave-84 dracula" style="background-color:#262335;--shiki-dark-bg:#282A36;color:#bbbbbb;--shiki-dark:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#FEDE5D;--shiki-dark:#FF79C6">const</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2"> x</span><span style="color:#FFFFFFEE;--shiki-dark:#FF79C6"> =</span><span style="color:#F97E72;--shiki-dark:#BD93F9"> 1</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FEDE5D;--shiki-dark:#FF79C6">const</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2"> y</span><span style="color:#FFFFFFEE;--shiki-dark:#FF79C6"> =</span><span style="color:#F97E72;--shiki-dark:#BD93F9"> 3</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FF7EDB;--shiki-dark:#F8F8F2">console</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">.</span><span style="color:#36F9F6;--shiki-dark:#50FA7B">log</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">(</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2">x</span><span style="color:#FEDE5D;--shiki-dark:#FF79C6">+</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2">y</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">)</span></span></code></pre>
<p>The program will first load <em>x</em>,<em>y</em> into the callstack then perform the <em>console.log</em> and exit the program. If there was a command that does some heavy computation or take time to complete, e.g <em>fs.readFile()</em>, node prefers to handle these asynchronously by loading them in a queue and coming back to process them later.</p>
<p>There are different types of queues that take care of different tasks. Once nodejs pushes commands into queues it will continue processing other requests in the callstack until the callstack is empty, then it checks the queues to see if there is anything thatâ€™s ready to be processed. The different types of queues are listed below in priority of how they are processed and what they typically handle</p>
<p><strong>Microtasks Queue</strong> - process.nextTick, Mutation Observer, Promises</p>
<p><strong>Timer Queue</strong> - setTimeout, setInterval</p>
<p><strong>I/O Queue</strong> - file system, network events</p>
<p><strong>Check Queue</strong> - setImmediate calls</p>
<p><strong>Close Queue</strong> - Close handlers, file, network connection</p>
<p>The <em>IO</em> queue handles IO related things i.e reading files, database connections. These kind of operations are usually offloaded to <a href="https://github.com/libuv/libuv">Libuv</a> a cross-platform library implemented in C++, that also handles child processes and signals. Libuv maintains about 4 threads that it uses to do IO in a non blocking manner.</p>
<p>Async workflow example</p>
<pre class="astro-code astro-code-themes synthwave-84 dracula" style="background-color:#262335;--shiki-dark-bg:#282A36;color:#bbbbbb;--shiki-dark:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="typescript"><code><span class="line"><span style="color:#FEDE5D;--shiki-dark:#FF79C6">import</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2"> fs</span><span style="color:#FEDE5D;--shiki-dark:#FF79C6"> from</span><span style="color:#FF8B39;--shiki-dark:#E9F284"> '</span><span style="color:#FF8B39;--shiki-dark:#F1FA8C">fs</span><span style="color:#FF8B39;--shiki-dark:#E9F284">'</span></span>
<span class="line"><span style="color:#FEDE5D;--shiki-dark:#FF79C6">const</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2"> x</span><span style="color:#FFFFFFEE;--shiki-dark:#FF79C6"> =</span><span style="color:#F97E72;--shiki-dark:#BD93F9"> 1</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FEDE5D;--shiki-dark:#FF79C6">const</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2"> y</span><span style="color:#FFFFFFEE;--shiki-dark:#FF79C6"> =</span><span style="color:#F97E72;--shiki-dark:#BD93F9"> 3</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">;</span></span>
<span class="line"><span style="color:#FEDE5D;--shiki-dark:#FF79C6">const</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2"> file</span><span style="color:#FFFFFFEE;--shiki-dark:#FF79C6"> =</span><span style="color:#FF7EDB;--shiki-dark:#F8F8F2"> fs</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">.</span><span style="color:#36F9F6;--shiki-dark:#50FA7B">readFile</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">(</span><span style="color:#FF8B39;--shiki-dark:#E9F284">'</span><span style="color:#FF8B39;--shiki-dark:#F1FA8C">myfile.txt</span><span style="color:#FF8B39;--shiki-dark:#E9F284">'</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">, </span><span style="color:#FF8B39;--shiki-dark:#E9F284">'</span><span style="color:#FF8B39;--shiki-dark:#F1FA8C">utf8</span><span style="color:#FF8B39;--shiki-dark:#E9F284">'</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">, (</span><span style="color:#FF7EDB;--shiki-light-font-style:italic;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic">err</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">, </span><span style="color:#FF7EDB;--shiki-light-font-style:italic;--shiki-dark:#FFB86C;--shiki-dark-font-style:italic">data</span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">) </span><span style="color:#FEDE5D;--shiki-dark:#FF79C6">=></span><span style="color:#BBBBBB;--shiki-dark:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#848BBD;--shiki-light-font-style:italic;--shiki-dark:#6272A4;--shiki-dark-font-style:inherit">    // do something with this data</span></span>
<span class="line"><span style="color:#848BBD;--shiki-light-font-style:italic;--shiki-dark:#6272A4;--shiki-dark-font-style:inherit">    // this will not block, it will be pushed to the io queue as another users requests is processed</span></span>
<span class="line"><span style="color:#BBBBBB;--shiki-dark:#F8F8F2">});</span></span></code></pre>
<p>NodeJS maintains context by wrapping the functions in a closure before sending them to a queue to be processed. That way, it can serve multiple users requests and still maintain this important context to differentiate one user from another.</p>
<hr>
<h4 id="references">References</h4>
<p><a href="https://www.geeksforgeeks.org/node-js-fs-readfile-method/">https://www.geeksforgeeks.org/node-js-fs-readfile-method/</a>
<a href="https://www.freecodecamp.org/news/nodejs-eventloop-tutorial/">https://www.freecodecamp.org/news/nodejs-eventloop-tutorial/</a><br>
<a href="https://viewer.diagrams.net/index.html?tags=%7B%7D&#x26;highlight=0000ff&#x26;edit=_blank&#x26;layers=1&#x26;nav=1&#x26;title=Diagrams.drawio#R7VldU%2BM2FP01mdl9gInjfJBHEmhhCoVumGlfZVuONZElryTjZH9975Xkj8RhF6bQbtl9IChX8rV07tG5V8ogXObbXxUpsluZUD4YDZPtILwYjEZBOBzDP7TsnGU2mjnDWrHEmYatYcW%2BUP9kbS1ZQrW3OZORkhtW7BtjKQSNzZ6NKCWr%2FWGp5MmeoSBr2jOsYsL71j9ZYjJnPatXgfYrytZZ%2FeZgOnc9EYk3ayVL4d8npKCuJye1G79GnZFEVh1TeDkIl0pK41r5dkk5wrqP2C9P9DZTVlSY5zxAzHL21%2B9RJLLzYH5WVTP%2BGz%2FxXh4JLz0UD0RvwPJHScEymnLwvYgUtNbY%2BrAknOOi6yEf%2FeLMrsayypihq4LE%2BL0CvsBjmck5fAugSXThIpiyLYWpLfwMqDJ0%2B%2BTSggYw4CCVOTVqB0P8A%2BHEY%2BzpN6q%2FV51gelPWiWNtI54%2B68ZziyM0PJQvgHXUg%2FWWxUruY%2Fv94RZO%2F2Pcwh5uNQUlrylYWzirLVdEJBzkYzS8voMPWVBFDJMCLfR0DZ%2BKkoQJbKXMjnQuYI6tl6%2F5NSynChqwquHF3S36fQSM2xeQJLlEyw3ThgqqXvyGikbopmCNSwCVy9gu5MXecqo1Sh6SQWu3cucV3qNlvKE49ynJkWQi0kXH39GXgLEbgQPqAgPNAVs5Wwtoc5piD7KUgdyee3POkgQfXiiq2RcSWUdD%2BF5IhrCC18liMLlAT6WR2iUMdKyNkhu6BGgUWKzchgsIKj8wvcLuGAfhvqqM%2B7sjDI9sj2D4Vvtj%2FA%2F3R6FkzjTyAogVZ8jsjAobTGJo7ij9LK7dlsZTcygjTdUjcn54fn%2F98s0Fk4qBr6cCWPTA4s2Hjz%2BpeEjF0YFQH0lwo9m%2FqdSTfuGQ0VoX4T%2BXsmhj60TUDjiSCIcRTaWizZCvpsmnAxzDm4GF%2F9MQN0riQxzM%2ByEeD4%2BEOHyrEM96IcbiDywrYwvAw9rQZAzDrEqbePVOxJmSQpY29hBS3YulLZyxmLHR%2BEYBlDAFBRBKTnihZYmYvAbujVjXKj%2Fq4x4cU%2FkmHbw68EFf5i%2F9trqx2%2BpJGINvw%2FgKkDUr95BNgueVjZM3A6yvRvcd4WlqNSYajYkdlTVS%2BRQadyL2AmSFiNhPIbGWctJEkNAtk%2BF82sobujb9DVFbEva4F7Dp51LaDQNSduLV6xw102WodsChI10QcdRTeww9iZ0yndvlMsMIP%2Boyzmi8aVU5R1Wul%2FbZy%2FLBEgvFpGJm14KwbAuIrtAD%2F3L8n0K1Ub%2Bhyd1uDb2UbjH6%2FmEzLjVJ5Snkj8IWMaTRDYtKnDVroQVgtT4pODGQ5BAPziJF7H4yGcFNnbXnjIza6qx7hHknyEU7x5JH5k9iDLN1CjJlqWIR3Tu5EQscNBKWplQ5%2FfMjrAO9g7NW%2Fm4AAhLUxIE6pQAQGFYqNTY52XSXrT0BNbLuGqEp3ebrEA1vDFjK4vdJKHeepYW0Qm5PIpyJcutkaVOLmO3ISSwtpyzG13fL%2B7qnYiKRFaL4TmB5Og39XNoPepQYzyf9o8T82MXFm50lgv5hYgXlgrtASIghtfTlBHCEP5rYdCjLNd5SSKzLsJeSzq2edh6sFEq5YbQuSQBoP8ycxn3WPLi0WxHEjKVOO%2B31BeLBjFMKfH5bKFf7NDccTkESmkPD3ds1ep3UJRNMlqlB565t0Pxy4RZs61AsmsEvdCS6P8fKFamd0qqd5sJmTGaTA2KHKWDVar0fxQSmgeaSRtl5gipqXwp3e%2FvQl%2F7W8MoYPMd%2Fck9CaymF3Te9GTtkYi51aQvmtBSxzzg%2FxB3N5Gxv003DeW%2FTTY%2BdimYv33Pwtf3dyPZ1fpcLL%2F8G#%7B%22pageId%22%3A%22K0AqEqVVdicwrlIVKQc0%22%7D">diagram 1</a><br>
<a href="https://www.builder.io/blog/visual-guide-to-nodejs-event-loop">Visual Guide</a></p>  </div> </div> </main> <div id="data-container" data-likes="0" data-reads="0" data-hash="d94451fb080018591bbb320ab6201412ba9dbf8280d803e730f4d8534ef8c342" data-astro-cid-bvzihdzo></div>  <script type="module" src="/_astro/BlogPost.astro_astro_type_script_index_1_lang.BtOU-HKl.js"></script> </body> </html>